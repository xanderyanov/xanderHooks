<div class="row V3">
  <div class="col-xs-12">
    <div class="row mb-3 tovarEditItemContainer">
      <div class="col-lg-auto">
        <div class="controlBtn CommentToggle" title="CommentToggle" onclick="ClickTovarCommentToggle(this)"><span
              class="bi bi-chat-left-text"></span></div>
      </div>
      <div class="col-lg">
        <div class="row">
          <div class="col-12 col-xl-6 mb-3 mb-xl-0">
            @V3_MmxQuickSearch(x => x.ItemRef, "Product", new LabelModel(LC("Товар", "Product"), horizontal: false),
            new PickFormModel() { AllowNull = false, OnValChange = "FolioCalc();" })
          </div>
          <div class="col-md-2 col-xl-2 mb-3 mb-xl-0 text-center">
            @V3_MmxDoubleBox(x => x.Price, new LabelModel(LC("Цена", "Price"), horizontal: false), updateAttrs)
          </div>
          <div class="col-md-1 col-xl-1 mb-3 mb-xl-0 text-center">
            @V3_MmxDoubleBox(x => x.Quantity, new LabelModel(LC("Колич.", "Quantity"), horizontal: false), updateAttrs)
          </div>
          <div class="col-md-2 col-xl-1 mb-3 mb-xl-0 text-center">
            @V3_MmxDoubleBox(x => x.Discount, new LabelModel(LC("Скидка", "Discount"), horizontal: false), updateAttrs)
          </div>
          <div class="col-md-2 col-xl-2 mb-3 mb-xl-0 text-center">
            @*@MmxLabeled(LC("Сумма", "Sum"), new HtmlString($"<span id=\"{Html.IdFor(x =>
              x.Sum)}\">{Utils.FormatSumShort(Model.Sum)}</span>"))*@
            @V3_MmxDoubleBox(x => x.Sum, new LabelModel(LC("Сумма", "Sum"), horizontal: false), ReadOnly: true)
          </div>
          <div class="col-md-12 col-xl-12 commentToggleArea active">
            <div class="mt-3">
              @V3_MmxTextBox(x => x.Comment, new LabelModel(LC("Примечание", "Comment"), horizontal: false))
            </div>
          </div>
          <div class="col-md-12 col-xl-12 d-flex align-items-center mt-3">
            @V3_MmxCheckBoxCustom(x => x.SpecialistRecommended, new LabelModel(LC("Рекомендовано специалистом",
            "Recommended by specialist"), horizontal: false))
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function ClickTovarCommentToggle(e) {
    var active = e.closest(".tovarEditItemContainer").querySelector('.commentToggleArea.active');
    if (active) {
      active.classList.remove('active');
    } else {
      e.closest(".tovarEditItemContainer").querySelector('.commentToggleArea').classList.add('active');
    }
  }
</script>